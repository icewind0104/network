{% extends "ipmanage/base.html" %}

{% block head %}
<script type="text/javascript">
    $('document').ready(function(){
        //alert('hello world!')
        $("a.success").click(
            function(){
                $("#use_ip_id").val($(this).attr('id'));
            });

        $("a.modify").click(
            function(){
                $("#modify_ip_id").val($(this).attr('id'));
                $("#modifyinput").val($(this).parent().parent().parent().find('td.user').text());
            });

        $("a.netmodify").click(
            function(){
                $("#modify_net_id").val($(this).attr('id'));
                $("#netmodifyname").val($(this).parent().find('#netname').text());
                $("#netmodifydesc").val($(this).parent().find('#netdesc').text());
            });

        $("a.netdelete").click(
            function(){
                $("#delete_net_id").val($(this).attr('id'));
                $("#netdeletebox").find(".motion").text($(this).parent().find("#netname").text())
            });

        $("a.warnning").click(
            function(){
                $("#disuse_ip_id").val($(this).attr('id'));
                $("#disusebox").find(".motion").text(
                    $(this).parent().parent().parent().find(".user").text()+$(this).parent().parent().parent().find(".ipaddr").text()
                );
            });

        $("a.danger").click(
            function(){
                $("#delete_ip_id").val($(this).attr('id'));
                $("#deletebox").find(".motion").text(
                    $(this).parent().parent().parent().find(".user").text()+$(this).parent().parent().parent().find(".ipaddr").text()
                );
            });

    });
</script>
{% endblock %}

{% block right %}
    <div class="uk-width-3-4">
        <!-- search box -->
        <div class="uk-container" style="padding:0px;" data-uk-sticky="{top:10}">
            <div class="uk-flex-right uk-grid">
                <div class="uk-width-1-2"></div>
                <div class="uk-text-right uk-width-1-2">
                <form class="uk-form" method="POST" action="{% if last_get %}{{ last_get }}{% endif %}">
                    {% csrf_token %}
                    <fieldset data-uk-margin>
                        <div class="uk-form-icon"><i class="uk-icon-search"></i>
                        <input placeholder="search..." autocomplete="off" type="text" name="search" value="{% if search_key %}{{search_key}}{% endif %}">
                        <button class="uk-button mybutton">搜索</button></div>
                    </fieldset>
                </from>
                </div>
            </div>
        </div>

        <!-- operate box -->
        <div class="uk-container uk-grid">
            <div><a class="success" href="#muti_add" data-uk-modal><i class="uk-icon-plus-square"></i>&nbsp;添加</a></div>
            {% if IP_count %}<div><a class="danger" href="#muti_delete" data-uk-modal><i class="uk-icon-minus-square"></i>&nbsp;删除</a></div>{% else %}<div style="color:#aaa"><i class="uk-icon-minus-square"></i>&nbsp;删除</div>{% endif %}
        </div>

        <!-- table list -->
        <div class="uk-overflow-container">
            <table class="uk-table uk-text-nowrap uk-table-hover uk-table-striped">
                <thead>
                    <tr style="background-image:linear-gradient(to bottom,#fff,#eee);">
                        <th class="uk-width-1-5">IP地址</th>
                        <th class="uk-width-1-5">使用人</th>
                        <th class="uk-width-1-5">
                            <ul class="uk-subnav">
                                <li data-uk-dropdown="{mode:'click'}">
                                    <a href="#">
                                    {% ifequal Filter "used" %}已使用
                                    {% else %}
                                        {% ifequal Filter "nonuse" %}可用
                                        {% else %}全部
                                        {% endifequal %}
                                    {% endifequal %}&nbsp;
                                        <i class="uk-icon-caret-down"></i>
                                    </a>
                                    <div class="uk-dropdown uk-dropdown-small">
                                        <ul class="uk-nav uk-nav-dropdown">
                                            <li><a href="{% if last_get %}{{ last_get }}{% endif %}&filter=all">全部</a></li>
                                            <li><a href="{% if last_get %}{{ last_get }}{% endif %}&filter=used">已使用</a></li>
                                            <li><a href="{% if last_get %}{{ last_get }}{% endif %}&filter=nonuse">可用</a></li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </th>
                        <th class="uk-width-1-5">归属网络</th>
                        <th class="uk-width-1-5">操作</th>
                    </tr>
                </thead>
                <tbody>
                {% for IP in IPs.object_list %}
                    <tr class="uk-visible-hover-inline" id="{% if IP.person %}used{% endif %}">
                        <td class="uk-width-1-5 ipaddr">{{ IP.ip_addr|safe }}</td>
                        <td class="uk-width-1-5 user">{% if IP.person %}{{ IP.person|safe }}{% endif %}</td>
                        <td class="uk-width-1-5">{% if IP.person %}已使用{% else %}可用{% endif %}</td>
                        <td class="uk-width-1-5">{{ IP.net_id__name }}</td>
                        <td  class="uk-width-1-5">
                            <div>
                                {% if not IP.person %}<a id="{{IP.id}}" class="success" href="#usebox" data-uk-modal><i class="uk-icon-user-plus"></i></a>{% endif %}
                                {% if IP.person %}<a id="{{IP.id}}" class="modify" href="#modifybox" data-uk-modal><i class="uk-icon-pencil-square-o"></i></a>{% endif %}
                                {% if IP.person %}<a id="{{IP.id}}" class="warnning" href="#disusebox" data-uk-modal><i class="uk-icon-user-times"></i></a>{% endif %}
                                <a id="{{IP.id}}" class="danger" href="#deletebox" data-uk-modal><i class="uk-icon-times-circle"></i></a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% if not IPs %}
            <div class="uk-alert uk-alert-warning">
                {% if IP_count %}未找到相关内容 ....{% else %}你还没有添加可用的IP地址哟{%endif%}
            </div>
            {% endif %}
        </div>

        <!-- pagination -->
        <ul class="uk-pagination uk-panel uk-panel-box" style="padding:15px;">
            <li><a href="{% if last_get %}{{ last_get }}{% endif %}&page=0">1</a></li>

            {% if IPs.has_previous %}
                <li><a href="{% if last_get %}{{ last_get }}{% endif %}&page={{ IPs.previous_page_number }}"><span><<</span></a></li>
            {% else %}
                <li class="uk-disabled"><span><<</span></li>
            {% endif %}

            {% for p in page_range %}
                {% ifequal p "..." %}<li><span>{{p}}</span></li>
                {% else %}
                    {% ifequal p IPs.number %}
                        <li class="uk-active"><span>{{p}}</span></li>
                    {% else %}
                        <li><a href="{% if last_get %}{{ last_get }}{% endif %}&page={{ p }}">{{p}}</a></li>
                    {% endifequal %}
                {% endifequal %}
            {% endfor %}

            {% if IPs.has_next %}
                <li><a href="{% if last_get %}{{ last_get }}{% endif %}&page={{ IPs.next_page_number }}"><span>>></span></a></li>
            {% else %}
                <li class="uk-disabled"><span>>></span></li>
            {% endif %}
            <li><a href="{% if last_get %}{{ last_get }}{% endif %}&page={{ IPs.paginator.num_pages }}">{% if IPs.paginator.num_pages %}{{ IPs.paginator.num_pages }}{% else %}1{% endif %}</a></li>
        </ul>

    </div>

<!-- IP 操作 -->
<form>
</form>
<form action="{% url 'ipmanage:net_deal_ip_modify' net.id %}" class="uk-form" method="POST">
    <div id="usebox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-user-plus uk-icon-medium" style="color:#8CC14C;"></i><h2>启用该IP地址</h2></div>
            请输入使用人姓名：<input type="text" autocomplete="off" name="person">
            <input type="text" class="uk-hidden" name="ip_id" id="use_ip_id">
            <input type="text" class="uk-hidden" name="operate" value="use">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-primary">确定</button>
            </div>
        </div>
    </div>
</form>
<form action="{% url 'ipmanage:net_deal_ip_modify' net.id %}" class="uk-form" method="POST">
    <div id="disusebox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-user-times uk-icon-medium" style="color:#faa732;"></i><h2>停用该IP地址</h2></div>
            确定需要停用&nbsp;<span class="motion"></span>&nbsp;吗？
            <input type="text" class="uk-hidden" name="ip_id" id="disuse_ip_id">
            <input type="text" class="uk-hidden" name="operate" value="disuse">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-primary">确定</button>
            </div>
        </div>
    </div>
</form>
<form action="{% url 'ipmanage:net_deal_ip_modify' net.id %}" class="uk-form" method="POST">
    <div id="modifybox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-pencil-square-o uk-icon-medium" style="color:#07d;"></i><h2>修改使用人</h2></div>
            修改使用人姓名为：<input type="text" autocomplete="off" id="modifyinput" name="person">
            <input type="text" class="uk-hidden" name="ip_id" id="modify_ip_id">
            <input type="text" class="uk-hidden" name="operate" value="modify">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-primary">确定</button>
            </div>
        </div>
    </div>
</form>
<form action="{% url 'ipmanage:net_deal_ip_modify' net.id %}" class="uk-form" method="POST">
    <div id="deletebox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-times-circle uk-icon-medium" style="color:#f00;"></i><h2>删除IP地址</h2></div>
            确定需要删除&nbsp;<span class="motion"></span>&nbsp;吗？
            <input type="text" class="uk-hidden" name="ip_id" id="delete_ip_id">
            <input type="text" class="uk-hidden" name="operate" value="delete">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-danger">确定</button>
            </div>
        </div>
    </div>
</form>

<!-- 批量添加|删除 IP -->
<form action="{% url 'ipmanage:net_deal_muti_modify' net.id %}" class="uk-form" method="POST">
    <div id="muti_delete" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-times uk-icon-medium" style="color:#f00;"></i><h2>批量删除IP地址</h2></div>
            删除IP地址范围：<br>从<input type="text" placeholder="示例：192.168.0.1" autocomplete="off" name="start">
            到<input type="text" placeholder="示例：192.168.0.254" autocomplete="off" name="end">(该项留空仅删除启始IP)
            <input type="text" class="uk-hidden" name="operate" value="muti_delete">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-danger">确定</button>
            </div>
        </div>
    </div>
</form>

<form action="{% url 'ipmanage:net_deal_muti_modify' net.id %}" class="uk-form" method="POST">
    <div id="muti_add" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-plus uk-icon-medium" style="color:#8CC14C;"></i><h2>批量添加IP地址</h2></div>
            添加IP地址范围：<br>从<input type="text" placeholder="示例：192.168.0.1" autocomplete="off" name="start">
            到<input type="text" placeholder="示例：192.168.0.254" autocomplete="off" name="end">(该项留空仅添加启始IP)
            <div style="margin-top:10px;color:#07d"><i class="uk-icon-exclamation-circle"></i>&nbsp;添加操作不会影响已存在的数据。</div>
            <input type="text" class="uk-hidden" name="operate" value="muti_add">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-primary">确定</button>
            </div>
        </div>
    </div>
</form>

<!-- 网络操作 -->
<form action="{% url 'ipmanage:net_deal_net_modify' %}" class="uk-form uk-form-horizontal" method="POST">
    <div id="netmodifybox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-pencil-square-o uk-icon-medium" style="color:#07d;"></i><h2>修改网络</h2></div>
            <div class="uk-form-row"><label class="uk-form-label">网络名称<span style="color:#07d;">（必填）</span></label><div class="uk-form-controls"><input id="netmodifyname" type="text" autocomplete="off" id="modifyinput" name="name"></div></div>
            <div class="uk-form-row"><label class="uk-form-label">附加描述</label><div class="uk-form-controls"><textarea id="netmodifydesc" type="text" autocomplete="off" id="modifyinput" name="desc"></textarea></div></div>
            <input type="text" class="uk-hidden" name="net_id" id="modify_net_id">
            <input type="text" class="uk-hidden" name="operate" value="modify">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-primary">确定</button>
            </div>
        </div>
    </div>
</form>

<form action="{% url 'ipmanage:net_deal_net_modify' %}" class="uk-form" method="POST">
    <div id="netdeletebox" class="uk-modal">
        <div class="uk-modal-dialog">
        {% csrf_token %}
            <div class="uk-modal-header uk-grid"><i class="uk-icon-times-circle uk-icon-medium" style="color:#f00;"></i><h2>删除网络</h2></div>
            确定需要删除网络&nbsp;<span class="motion"></span>&nbsp;吗？
            <div style="margin-top:10px;color:#f00"><i class="uk-icon-exclamation-triangle"></i>&nbsp;警告&nbsp;该操作将会删除此网络下的所有数据，包括IP地址信息。</div>
            <input type="text" class="uk-hidden" name="net_id" id="delete_net_id">
            <input type="text" class="uk-hidden" name="operate" value="delete">
            <div class="uk-modal-footer uk-text-right">
                <button class="uk-button uk-modal-close" type="button">取消</button>
                <button class="uk-button uk-button-danger">确定</button>
            </div>
        </div>
    </div>
</form>

{% endblock %}
